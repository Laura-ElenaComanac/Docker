{"ast":null,"code":"import _regeneratorRuntime from\"/Users/laura-elena.olaru/Downloads/FinalDocker/my-ionic-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/laura-elena.olaru/Downloads/FinalDocker/my-ionic-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/laura-elena.olaru/Downloads/FinalDocker/my-ionic-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/laura-elena.olaru/Downloads/FinalDocker/my-ionic-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useState}from'react';import{getLogger}from'../core';import{login as loginApi}from'./authApi';var log=getLogger('AuthProvider');var initialState={isAuthenticated:false,isAuthenticating:false,authenticationError:null,pendingAuthentication:false,token:''};export var AuthContext=React.createContext(initialState);export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(initialState),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var isAuthenticated=state.isAuthenticated,isAuthenticating=state.isAuthenticating,authenticationError=state.authenticationError,pendingAuthentication=state.pendingAuthentication,token=state.token;var login=useCallback(loginCallback,[]);useEffect(authenticationEffect,[pendingAuthentication]);var value={isAuthenticated:isAuthenticated,login:login,isAuthenticating:isAuthenticating,authenticationError:authenticationError,token:token};log('render');return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:value},children);function loginCallback(username,password){log('login');setState(_objectSpread(_objectSpread({},state),{},{pendingAuthentication:true,username:username,password:password}));}function authenticationEffect(){var canceled=false;authenticate();return function(){canceled=true;};function authenticate(){return _authenticate.apply(this,arguments);}function _authenticate(){_authenticate=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _username,_password,_yield$loginApi,_token;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(pendingAuthentication){_context.next=3;break;}log('authenticate, !pendingAuthentication, return');return _context.abrupt(\"return\");case 3:_context.prev=3;log('authenticate...');setState(_objectSpread(_objectSpread({},state),{},{isAuthenticating:true}));_username=state.username,_password=state.password;_context.next=9;return loginApi(_username,_password);case 9:_yield$loginApi=_context.sent;_token=_yield$loginApi.access_token;if(!canceled){_context.next=13;break;}return _context.abrupt(\"return\");case 13:log('authenticate succeeded');setState(_objectSpread(_objectSpread({},state),{},{token:_token,pendingAuthentication:false,isAuthenticated:true,isAuthenticating:false}));_context.next=23;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](3);if(!canceled){_context.next=21;break;}return _context.abrupt(\"return\");case 21:log('authenticate failed');setState(_objectSpread(_objectSpread({},state),{},{authenticationError:_context.t0,pendingAuthentication:false,isAuthenticating:false}));case 23:case\"end\":return _context.stop();}}},_callee,null,[[3,17]]);}));return _authenticate.apply(this,arguments);}}};","map":{"version":3,"sources":["/Users/laura-elena.olaru/Downloads/FinalDocker/my-ionic-app/src/auth/AuthProvider.tsx"],"names":["React","useCallback","useEffect","useState","getLogger","login","loginApi","log","initialState","isAuthenticated","isAuthenticating","authenticationError","pendingAuthentication","token","AuthContext","createContext","AuthProvider","children","state","setState","loginCallback","authenticationEffect","value","username","password","canceled","authenticate","access_token"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { getLogger } from '../core';\nimport { login as loginApi } from './authApi';\n\nconst log = getLogger('AuthProvider');\n\ntype LoginFn = (username?: string, password?: string) => void;\n\nexport interface AuthState {\n  authenticationError: Error | null;\n  isAuthenticated: boolean;\n  isAuthenticating: boolean;\n  login?: LoginFn;\n  pendingAuthentication?: boolean;\n  username?: string;\n  password?: string;\n  token: string;\n}\n\nconst initialState: AuthState = {\n  isAuthenticated: false,\n  isAuthenticating: false,\n  authenticationError: null,\n  pendingAuthentication: false,\n  token: '',\n};\n\nexport const AuthContext = React.createContext<AuthState>(initialState);\n\ninterface AuthProviderProps {\n  children: PropTypes.ReactNodeLike,\n}\n\nexport const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {\n  const [state, setState] = useState<AuthState>(initialState);\n  const { isAuthenticated, isAuthenticating, authenticationError, pendingAuthentication, token } = state;\n  const login = useCallback<LoginFn>(loginCallback, []);\n  useEffect(authenticationEffect, [pendingAuthentication]);\n  const value = { isAuthenticated, login, isAuthenticating, authenticationError, token };\n  log('render');\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n\n  function loginCallback(username?: string, password?: string): void {\n    log('login');\n    setState({\n      ...state,\n      pendingAuthentication: true,\n      username,\n      password\n    });\n  }\n\n  function authenticationEffect() {\n    let canceled = false;\n    authenticate();\n    return () => {\n      canceled = true;\n    }\n\n    async function authenticate() {\n      if (!pendingAuthentication) {\n        log('authenticate, !pendingAuthentication, return');\n        return;\n      }\n      try {\n        log('authenticate...');\n        setState({\n          ...state,\n          isAuthenticating: true,\n        });\n        const { username, password } = state;\n        const { access_token: token } = await loginApi(username, password);\n        if (canceled) {\n          return;\n        }\n        log('authenticate succeeded');\n        setState({\n          ...state,\n          token,\n          pendingAuthentication: false,\n          isAuthenticated: true,\n          isAuthenticating: false,\n        });\n      } catch (error) {\n        if (canceled) {\n          return;\n        }\n        log('authenticate failed');\n        setState({\n          ...state,\n          authenticationError: error,\n          pendingAuthentication: false,\n          isAuthenticating: false,\n        });\n      }\n    }\n  }\n};\n"]},"metadata":{},"sourceType":"module"}