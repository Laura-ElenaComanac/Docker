{"ast":null,"code":"var _jsxFileName = \"/Users/laura-elena.olaru/Downloads/Microservices/my-ionic-app/src/auth/AuthProvider.tsx\";\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { getLogger } from '../core';\nimport { login as loginApi } from './authApi';\nconst log = getLogger('AuthProvider');\nconst initialState = {\n  isAuthenticated: false,\n  isAuthenticating: false,\n  authenticationError: null,\n  pendingAuthentication: false,\n  token: ''\n};\nexport const AuthContext = React.createContext(initialState);\nexport const AuthProvider = ({\n  children\n}) => {\n  const [state, setState] = useState(initialState);\n  const {\n    isAuthenticated,\n    isAuthenticating,\n    authenticationError,\n    pendingAuthentication,\n    token\n  } = state;\n  const login = useCallback(loginCallback, []);\n  useEffect(authenticationEffect, [pendingAuthentication]);\n  const value = {\n    isAuthenticated,\n    login,\n    isAuthenticating,\n    authenticationError,\n    token\n  };\n  log('render');\n  return /*#__PURE__*/React.createElement(AuthContext.Provider, {\n    value: value,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 5\n    }\n  }, children);\n\n  function loginCallback(username, password) {\n    log('login');\n    setState({ ...state,\n      pendingAuthentication: true,\n      username,\n      password\n    });\n  }\n\n  function authenticationEffect() {\n    let canceled = false;\n    authenticate();\n    return () => {\n      canceled = true;\n    };\n\n    async function authenticate() {\n      if (!pendingAuthentication) {\n        log('authenticate, !pendingAuthentication, return');\n        return;\n      }\n\n      try {\n        log('authenticate...');\n        setState({ ...state,\n          isAuthenticating: true\n        });\n        const {\n          username,\n          password\n        } = state;\n        const {\n          access_token: token\n        } = await loginApi(username, password);\n\n        if (canceled) {\n          return;\n        }\n\n        log('authenticate succeeded');\n        setState({ ...state,\n          token,\n          pendingAuthentication: false,\n          isAuthenticated: true,\n          isAuthenticating: false\n        });\n      } catch (error) {\n        if (canceled) {\n          return;\n        }\n\n        log('authenticate failed');\n        setState({ ...state,\n          authenticationError: error,\n          pendingAuthentication: false,\n          isAuthenticating: false\n        });\n      }\n    }\n  }\n};","map":{"version":3,"sources":["/Users/laura-elena.olaru/Downloads/Microservices/my-ionic-app/src/auth/AuthProvider.tsx"],"names":["React","useCallback","useEffect","useState","getLogger","login","loginApi","log","initialState","isAuthenticated","isAuthenticating","authenticationError","pendingAuthentication","token","AuthContext","createContext","AuthProvider","children","state","setState","loginCallback","authenticationEffect","value","username","password","canceled","authenticate","access_token","error"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,WAAhB,EAA6BC,SAA7B,EAAwCC,QAAxC,QAAwD,OAAxD;AAEA,SAASC,SAAT,QAA0B,SAA1B;AACA,SAASC,KAAK,IAAIC,QAAlB,QAAkC,WAAlC;AAEA,MAAMC,GAAG,GAAGH,SAAS,CAAC,cAAD,CAArB;AAeA,MAAMI,YAAuB,GAAG;AAC9BC,EAAAA,eAAe,EAAE,KADa;AAE9BC,EAAAA,gBAAgB,EAAE,KAFY;AAG9BC,EAAAA,mBAAmB,EAAE,IAHS;AAI9BC,EAAAA,qBAAqB,EAAE,KAJO;AAK9BC,EAAAA,KAAK,EAAE;AALuB,CAAhC;AAQA,OAAO,MAAMC,WAAW,GAAGd,KAAK,CAACe,aAAN,CAA+BP,YAA/B,CAApB;AAMP,OAAO,MAAMQ,YAAyC,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAkB;AACzE,QAAM,CAACC,KAAD,EAAQC,QAAR,IAAoBhB,QAAQ,CAAYK,YAAZ,CAAlC;AACA,QAAM;AAAEC,IAAAA,eAAF;AAAmBC,IAAAA,gBAAnB;AAAqCC,IAAAA,mBAArC;AAA0DC,IAAAA,qBAA1D;AAAiFC,IAAAA;AAAjF,MAA2FK,KAAjG;AACA,QAAMb,KAAK,GAAGJ,WAAW,CAAUmB,aAAV,EAAyB,EAAzB,CAAzB;AACAlB,EAAAA,SAAS,CAACmB,oBAAD,EAAuB,CAACT,qBAAD,CAAvB,CAAT;AACA,QAAMU,KAAK,GAAG;AAAEb,IAAAA,eAAF;AAAmBJ,IAAAA,KAAnB;AAA0BK,IAAAA,gBAA1B;AAA4CC,IAAAA,mBAA5C;AAAiEE,IAAAA;AAAjE,GAAd;AACAN,EAAAA,GAAG,CAAC,QAAD,CAAH;AACA,sBACE,oBAAC,WAAD,CAAa,QAAb;AAAsB,IAAA,KAAK,EAAEe,KAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGL,QADH,CADF;;AAMA,WAASG,aAAT,CAAuBG,QAAvB,EAA0CC,QAA1C,EAAmE;AACjEjB,IAAAA,GAAG,CAAC,OAAD,CAAH;AACAY,IAAAA,QAAQ,CAAC,EACP,GAAGD,KADI;AAEPN,MAAAA,qBAAqB,EAAE,IAFhB;AAGPW,MAAAA,QAHO;AAIPC,MAAAA;AAJO,KAAD,CAAR;AAMD;;AAED,WAASH,oBAAT,GAAgC;AAC9B,QAAII,QAAQ,GAAG,KAAf;AACAC,IAAAA,YAAY;AACZ,WAAO,MAAM;AACXD,MAAAA,QAAQ,GAAG,IAAX;AACD,KAFD;;AAIA,mBAAeC,YAAf,GAA8B;AAC5B,UAAI,CAACd,qBAAL,EAA4B;AAC1BL,QAAAA,GAAG,CAAC,8CAAD,CAAH;AACA;AACD;;AACD,UAAI;AACFA,QAAAA,GAAG,CAAC,iBAAD,CAAH;AACAY,QAAAA,QAAQ,CAAC,EACP,GAAGD,KADI;AAEPR,UAAAA,gBAAgB,EAAE;AAFX,SAAD,CAAR;AAIA,cAAM;AAAEa,UAAAA,QAAF;AAAYC,UAAAA;AAAZ,YAAyBN,KAA/B;AACA,cAAM;AAAES,UAAAA,YAAY,EAAEd;AAAhB,YAA0B,MAAMP,QAAQ,CAACiB,QAAD,EAAWC,QAAX,CAA9C;;AACA,YAAIC,QAAJ,EAAc;AACZ;AACD;;AACDlB,QAAAA,GAAG,CAAC,wBAAD,CAAH;AACAY,QAAAA,QAAQ,CAAC,EACP,GAAGD,KADI;AAEPL,UAAAA,KAFO;AAGPD,UAAAA,qBAAqB,EAAE,KAHhB;AAIPH,UAAAA,eAAe,EAAE,IAJV;AAKPC,UAAAA,gBAAgB,EAAE;AALX,SAAD,CAAR;AAOD,OAnBD,CAmBE,OAAOkB,KAAP,EAAc;AACd,YAAIH,QAAJ,EAAc;AACZ;AACD;;AACDlB,QAAAA,GAAG,CAAC,qBAAD,CAAH;AACAY,QAAAA,QAAQ,CAAC,EACP,GAAGD,KADI;AAEPP,UAAAA,mBAAmB,EAAEiB,KAFd;AAGPhB,UAAAA,qBAAqB,EAAE,KAHhB;AAIPF,UAAAA,gBAAgB,EAAE;AAJX,SAAD,CAAR;AAMD;AACF;AACF;AACF,CApEM","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { getLogger } from '../core';\nimport { login as loginApi } from './authApi';\n\nconst log = getLogger('AuthProvider');\n\ntype LoginFn = (username?: string, password?: string) => void;\n\nexport interface AuthState {\n  authenticationError: Error | null;\n  isAuthenticated: boolean;\n  isAuthenticating: boolean;\n  login?: LoginFn;\n  pendingAuthentication?: boolean;\n  username?: string;\n  password?: string;\n  token: string;\n}\n\nconst initialState: AuthState = {\n  isAuthenticated: false,\n  isAuthenticating: false,\n  authenticationError: null,\n  pendingAuthentication: false,\n  token: '',\n};\n\nexport const AuthContext = React.createContext<AuthState>(initialState);\n\ninterface AuthProviderProps {\n  children: PropTypes.ReactNodeLike,\n}\n\nexport const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {\n  const [state, setState] = useState<AuthState>(initialState);\n  const { isAuthenticated, isAuthenticating, authenticationError, pendingAuthentication, token } = state;\n  const login = useCallback<LoginFn>(loginCallback, []);\n  useEffect(authenticationEffect, [pendingAuthentication]);\n  const value = { isAuthenticated, login, isAuthenticating, authenticationError, token };\n  log('render');\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n\n  function loginCallback(username?: string, password?: string): void {\n    log('login');\n    setState({\n      ...state,\n      pendingAuthentication: true,\n      username,\n      password\n    });\n  }\n\n  function authenticationEffect() {\n    let canceled = false;\n    authenticate();\n    return () => {\n      canceled = true;\n    }\n\n    async function authenticate() {\n      if (!pendingAuthentication) {\n        log('authenticate, !pendingAuthentication, return');\n        return;\n      }\n      try {\n        log('authenticate...');\n        setState({\n          ...state,\n          isAuthenticating: true,\n        });\n        const { username, password } = state;\n        const { access_token: token } = await loginApi(username, password);\n        if (canceled) {\n          return;\n        }\n        log('authenticate succeeded');\n        setState({\n          ...state,\n          token,\n          pendingAuthentication: false,\n          isAuthenticated: true,\n          isAuthenticating: false,\n        });\n      } catch (error) {\n        if (canceled) {\n          return;\n        }\n        log('authenticate failed');\n        setState({\n          ...state,\n          authenticationError: error,\n          pendingAuthentication: false,\n          isAuthenticating: false,\n        });\n      }\n    }\n  }\n};\n"]},"metadata":{},"sourceType":"module"}